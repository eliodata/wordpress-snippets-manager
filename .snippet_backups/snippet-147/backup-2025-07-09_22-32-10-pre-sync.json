{
  "id": "147",
  "name": "Thème back-end Bloc woocommerce details de commande / remplacer par nouveau design",
  "description": "* Active: true  Active: true  Active: true  Active: true  Active: true  Active: true  Active: true  Active: true  Active: true  Active: true  Active: true  Active: true  Active: true  Active: true  Active: true  Active: true  Active: true  Active: true  Active: true  Active: true  Active: true  Active: true  Active: true  Active: true  Active: true  Active: true  Active: true  Active: true  Active: true  Active: true  Active: true  Active: true",
  "code": "/**\n * Plugin Name: FS - Amélioration Détails Commande WooCommerce\n * Description: Redesign du bloc détails de commande dans l'admin WooCommerce\n * Version: 1.4\n * Author: Formation Stratégique\n */\n\n// Empêcher l'accès direct\nif (!defined('ABSPATH')) {\n    exit;\n}\n\n/**\n * Ajoute les styles CSS personnalisés pour le bloc de détails commande\n */\nfunction fs_woocommerce_order_details_styles() {\n    // Ne charger les styles que sur les pages d'édition de commande WooCommerce\n    $screen = get_current_screen();\n    if ($screen && $screen->id === 'shop_order') {\n        ?>\n        <style>\n            /* Variables de couleurs cohérentes avec votre style existant */\n            :root {\n                --fs-primary-color: #4a6fdc;\n                --fs-primary-hover: #3a5ecc;\n                --fs-success-color: #28a745;\n                --fs-warning-color: #ffc107;\n                --fs-danger-color: #dc3545;\n                --fs-info-color: #17a2b8;\n                --fs-light-color: #f8f9fa;\n                --fs-dark-color: #343a40;\n                --fs-border-color: #dee2e6;\n                --fs-text-color: #333;\n            }\n            \n            /* Redesign UNIQUEMENT pour le bloc détails de commande */\n            #order_data {\n                font-family: \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, sans-serif;\n                color: var(--fs-text-color);\n                line-height: 1.4;\n                margin-bottom: 20px;\n                box-shadow: 0 2px 5px rgba(0,0,0,0.05);\n                border-radius: 5px;\n                overflow: hidden;\n            }\n            \n            /* Titre du bloc */\n            .woocommerce-order-data__heading {\n                font-size: 16px;\n                padding: 12px 15px;\n                margin: 0;\n                border-bottom: 2px solid var(--fs-primary-color);\n                background-color: var(--fs-light-color);\n                font-weight: 600;\n            }\n            \n            /* Conteneur des colonnes - Forcer l'alignement horizontal */\n            #order_data .order_data_column_container {\n                display: flex;\n                flex-wrap: nowrap; /* Empêche le passage à la ligne */\n                width: 100%;\n                padding: 0;\n                background: white;\n                border: 1px solid var(--fs-border-color);\n                border-top: none;\n            }\n\t\t\t\n\t\t\t#order_data {\n    \t\t\tpadding: 0px;\n\t\t\t\tmargin-bottom: 0px;\n\t\t\t}\n            \n            /* Style pour chaque colonne */\n            #order_data .order_data_column {\n                flex: 1; /* Chaque colonne prend 1/3 de l'espace */\n                min-width: 0; /* Permet la réduction en dessous de sa taille naturelle */\n                padding: 15px;\n                border-right: 1px solid var(--fs-border-color);\n                position: relative;\n                box-sizing: border-box;\n            }\n            \n            #order_data .order_data_column:last-child {\n                border-right: none;\n            }\n            \n            /* Codage couleur pour les colonnes */\n            #order_data .order_data_column:nth-child(1) {\n                border-left: 4px solid var(--fs-primary-color);\n            }\n            \n            #order_data .order_data_column:nth-child(2) {\n                border-left: 4px solid var(--fs-info-color);\n            }\n            \n            #order_data .order_data_column:nth-child(3) {\n                border-left: 4px solid var(--fs-success-color);\n            }\n            \n            /* Style compact des titres */\n            #order_data .order_data_column h3 {\n                font-size: 15px;\n                margin: 0 0 12px 0;\n                padding-bottom: 8px;\n                border-bottom: 1px solid var(--fs-border-color);\n                color: var(--fs-dark-color);\n                font-weight: 600;\n            }\n            \n            /* Remplacement du texte \"Expédition\" par \"Lieu de la formation\" via CSS */\n            #order_data .order_data_column:nth-child(3) h3 {\n                font-size: 0; /* Cache le texte original */\n            }\n            \n            #order_data .order_data_column:nth-child(3) h3::before {\n                content: \"Lieu de la formation\";\n                font-size: 15px; /* Restaure la taille de police */\n                font-weight: 600;\n            }\n            \n            /* Style des boutons d'édition */\n            #order_data .order_data_column h3 a.edit_address {\n                font-size: 13px !important;\n                margin-left: 8px;\n                opacity: 0.8;\n                transition: opacity 0.2s;\n                vertical-align: middle;\n                display: inline-block !important;\n                color: var(--fs-primary-color) !important;\n                text-decoration: none !important;\n                font-weight: 500 !important;\n            }\n            \n            #order_data .order_data_column h3 a.edit_address:hover {\n                opacity: 1;\n                color: var(--fs-primary-hover) !important;\n                text-decoration: underline !important;\n            }\n            \n            /* Réduire l'espacement des éléments */\n            #order_data .order_data_column p,\n            #order_data .order_data_column .address {\n                margin: 0 0 6px 0;\n                line-height: 1.3;\n                font-size: 12px;\n            }\n            \n            /* Optimisation globale du conteneur principal */\n            #order_data {\n                padding: 8px;\n            }\n            \n            #order_data .order_data_column_container {\n                margin: 0;\n                gap: 8px;\n            }\n            \n            #order_data .order_data_column {\n                padding: 8px 12px;\n                margin: 0;\n            }\n            \n            #order_data .order_data_column h3 {\n                margin: 0 0 8px 0;\n                padding: 0;\n                font-size: 14px;\n                line-height: 1.3;\n            }\n            \n            /* Style des adresses */\n            #order_data .order_data_column .address {\n                padding-left: 0;\n                font-style: normal;\n            }\n            \n            /* Style pour les liens */\n            #order_data .order_data_column a {\n                color: var(--fs-primary-color);\n                text-decoration: none;\n                font-weight: 500;\n                transition: all 0.2s ease;\n            }\n            \n            #order_data .order_data_column a:hover {\n                color: var(--fs-primary-hover);\n                text-decoration: underline;\n            }\n            \n            /* Style pour les détails client */\n            #order_data .order_data_column .wc-customer-user {\n                margin-bottom: 6px;\n                font-weight: 500;\n                font-size: 12px;\n                line-height: 1.3;\n            }\n            \n            /* Compacter les sélecteurs et dropdowns */\n            #order_data .order_data_column .wc-customer-search,\n            #order_data .order_data_column .select2-container {\n                margin-bottom: 4px;\n            }\n            \n            #order_data .order_data_column .select2-container .select2-selection {\n                height: 26px;\n                padding: 2px 6px;\n                font-size: 12px;\n            }\n            \n            #order_data .order_data_column .select2-container .select2-selection__rendered {\n                line-height: 22px;\n                font-size: 12px;\n            }\n            \n            /* Style des étiquettes */\n            #order_data .order_data_column label {\n                display: block;\n                font-size: 12px;\n                color: #666;\n                margin-bottom: 3px;\n                font-weight: 500;\n            }\n            \n            /* Style des champs inputs */\n            #order_data .order_data_column input[type=\"text\"],\n            #order_data .order_data_column input[type=\"email\"],\n            #order_data .order_data_column select {\n                width: 100%;\n                padding: 4px 6px;\n                margin-bottom: 6px;\n                border: 1px solid var(--fs-border-color);\n                border-radius: 3px;\n                font-size: 12px;\n                box-sizing: border-box;\n                transition: all 0.2s ease;\n                height: 26px;\n            }\n            \n            /* Mise en évidence au focus */\n            #order_data .order_data_column input[type=\"text\"]:focus,\n            #order_data .order_data_column input[type=\"email\"]:focus,\n            #order_data .order_data_column select:focus {\n                border-color: var(--fs-primary-color);\n                box-shadow: 0 0 0 2px rgba(74, 111, 220, 0.2);\n                outline: none;\n            }\n            \n            /* Style pour les informations téléphone et email */\n            #order_data .order_data_column .form-field {\n                margin-bottom: 4px;\n            }\n            \n            /* Styles spécifiques pour les formulaires d'édition d'adresses */\n            #order_data .order_data_column .edit_address,\n            #order_data .order_data_column h3 .edit_address,\n            #order_data .order_data_column h3 a.edit_address {\n                display: inline-block !important;\n                visibility: visible !important;\n                opacity: 0.8 !important;\n                font-size: 13px !important;\n                color: var(--fs-primary-color) !important;\n                text-decoration: none !important;\n                margin-left: 6px;\n                padding: 2px 6px;\n                border-radius: 3px;\n                background: rgba(74, 111, 220, 0.1);\n                transition: all 0.2s ease;\n            }\n            \n            #order_data .order_data_column .edit_address:hover,\n            #order_data .order_data_column h3 .edit_address:hover,\n            #order_data .order_data_column h3 a.edit_address:hover {\n                opacity: 1 !important;\n                background: rgba(74, 111, 220, 0.2);\n                color: var(--fs-primary-hover) !important;\n            }\n            \n            /* Réduction drastique des espaces dans les formulaires d'édition */\n            #order_data .order_data_column .form-field p {\n                margin: 0 0 4px 0;\n            }\n            \n            #order_data .order_data_column .form-field label {\n                margin-bottom: 2px;\n                font-size: 11px;\n                line-height: 1.2;\n            }\n            \n            /* Compacter les champs de formulaire en mode édition */\n            #order_data .order_data_column .form-field input,\n            #order_data .order_data_column .form-field select,\n            #order_data .order_data_column .form-field textarea {\n                margin-bottom: 4px;\n                padding: 3px 5px;\n                font-size: 11px;\n                height: 24px;\n                line-height: 1.2;\n            }\n            \n            #order_data .order_data_column .form-field textarea {\n                height: auto;\n                min-height: 40px;\n                resize: vertical;\n            }\n            \n            /* Réduire l'espacement entre les groupes de champs */\n            #order_data .order_data_column .form-field-wide {\n                margin-bottom: 6px;\n            }\n            \n            /* Compacter les champs sur deux colonnes */\n            #order_data .order_data_column .form-field-first,\n            #order_data .order_data_column .form-field-last {\n                width: 48%;\n                display: inline-block;\n                vertical-align: top;\n                margin-bottom: 4px;\n            }\n            \n            #order_data .order_data_column .form-field-first {\n                margin-right: 4%;\n            }\n            \n            /* Réduire l'espacement des paragraphes dans les adresses */\n            #order_data .order_data_column .address p {\n                margin: 0 0 2px 0;\n                line-height: 1.3;\n            }\n            \n            /* Aligner état et client sur la même ligne */\n            #order_data .order_data_column .form-field-row {\n                display: flex;\n                flex-wrap: wrap;\n                margin: 0 -3px;\n                align-items: flex-start;\n            }\n            \n            #order_data .order_data_column .form-field-row .form-field {\n                flex: 1 1 47%;\n                margin: 0 3px 6px;\n                min-width: 120px;\n            }\n            \n            /* Style pour les boutons et liens d'action */\n            #order_data .order_data_column .button-group {\n                margin-top: 6px;\n                display: flex;\n                flex-wrap: wrap;\n                align-items: center;\n                gap: 4px;\n            }\n            \n            #order_data .order_data_column .button-link {\n                margin: 0;\n                font-size: 11px;\n                display: inline-flex;\n                align-items: center;\n                padding: 2px 6px;\n                line-height: 1.2;\n            }\n            \n            #order_data .order_data_column .button-link:before {\n                content: '→';\n                margin-right: 2px;\n                font-size: 12px;\n            }\n            \n            /* Compacter les boutons d'action dans les formulaires */\n            #order_data .order_data_column .form-field .button,\n            #order_data .order_data_column .form-field input[type=\"submit\"],\n            #order_data .order_data_column .form-field input[type=\"button\"] {\n                padding: 3px 8px;\n                font-size: 11px;\n                height: 24px;\n                line-height: 1.2;\n                margin: 2px 4px 2px 0;\n            }\n            \n            /* Réduire l'espacement des actions de formulaire */\n            #order_data .order_data_column .form-field .form-field-actions {\n                margin-top: 4px;\n                margin-bottom: 4px;\n            }\n            \n            /* Optimiser l'affichage des liens d'édition */\n             #order_data .order_data_column h3 .edit_address {\n                 font-size: 13px !important;\n                 margin-left: 6px;\n                 padding: 2px 6px;\n                 display: inline-block !important;\n                 visibility: visible !important;\n                 opacity: 0.8 !important;\n             }\n             \n             #order_data .order_data_column h3 .edit_address:hover {\n                 opacity: 1 !important;\n             }\n            \n            /* Date de création */\n            #order_data .order_data_column .date-creation {\n                display: flex;\n                align-items: center;\n                margin-bottom: 8px;\n            }\n            \n            #order_data .order_data_column .date-creation input[type=\"text\"] {\n                margin-bottom: 0;\n                margin-right: 4px;\n                font-size: 11px;\n                height: 24px;\n                padding: 2px 4px;\n            }\n            \n            #order_data .order_data_column .date-creation span {\n                margin: 0 3px;\n                font-size: 11px;\n            }\n            \n            /* Optimisation spécifique pour les formulaires d'édition d'adresses */\n            #order_data .order_data_column .edit_address + div,\n            #order_data .order_data_column .edit_address ~ div {\n                margin-top: 4px;\n            }\n            \n            /* Réduire l'espacement dans les formulaires d'édition */\n            #order_data .order_data_column .form-field-wide,\n            #order_data .order_data_column .form-field-first,\n            #order_data .order_data_column .form-field-last {\n                margin-bottom: 4px;\n            }\n            \n            /* Compacter les champs de saisie dans les formulaires d'adresse */\n            #order_data .order_data_column .form-field input[type=\"text\"],\n            #order_data .order_data_column .form-field input[type=\"email\"],\n            #order_data .order_data_column .form-field input[type=\"tel\"],\n            #order_data .order_data_column .form-field select,\n            #order_data .order_data_column .form-field textarea {\n                padding: 2px 4px;\n                margin-bottom: 3px;\n                font-size: 11px;\n                height: 22px;\n                line-height: 1.2;\n            }\n            \n            #order_data .order_data_column .form-field textarea {\n                height: auto;\n                min-height: 36px;\n            }\n            \n            /* Réduire l'espacement des labels dans les formulaires */\n            #order_data .order_data_column .form-field label {\n                margin-bottom: 1px;\n                font-size: 10px;\n                font-weight: 500;\n                color: #666;\n                line-height: 1.2;\n            }\n            \n            /* Optimiser l'affichage des boutons de sauvegarde */\n            #order_data .order_data_column .form-field .button.save_order {\n                margin-top: 4px;\n                margin-bottom: 2px;\n                padding: 2px 6px;\n                font-size: 10px;\n                height: 22px;\n            }\n            \n            /* Numéro de commande et titre */\n            .commande-title {\n                font-size: 14px;\n                padding: 12px 15px;\n                margin: 0;\n                background-color: #d5ebff;\n                border-bottom: 2px solid var(--fs-primary-color);\n                font-weight: 600;\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n\t\t\t\tcolor: #1d2327;\n            }\n            \n            .commande-title .commande-numero {\n                font-weight: bold;\n                color: var(--fs-primary-color);\n            }\n            \n            .commande-title .commande-ip {\n                font-size: 13px;\n                color: #666;\n                font-weight: normal;\n            }\n            \n            /* Styles supplémentaires pour une compacité maximale */\n            #order_data .order_data_column .form-field br {\n                display: none;\n            }\n            \n            #order_data .order_data_column .form-field > p {\n                margin: 0 0 2px 0;\n            }\n            \n            /* Optimiser les espacements des éléments de formulaire */\n            #order_data .order_data_column .form-field .description {\n                font-size: 10px;\n                margin: 1px 0 2px 0;\n                line-height: 1.2;\n                color: #666;\n            }\n            \n            /* Réduire l'espacement des groupes de boutons */\n            #order_data .order_data_column .form-field .button-group,\n            #order_data .order_data_column .form-field .form-field-actions {\n                margin: 2px 0;\n                gap: 2px;\n            }\n            \n            /* Compacter les liens et actions */\n            #order_data .order_data_column a {\n                line-height: 1.2;\n                font-size: 11px;\n            }\n            \n            /* Réduire l'espacement des dividers */\n            #order_data .order_data_column hr {\n                margin: 4px 0;\n            }\n            \n            /* Optimiser l'affichage des notes et commentaires */\n            #order_data .order_data_column .note,\n            #order_data .order_data_column .order_note {\n                margin: 2px 0;\n                padding: 2px 4px;\n                font-size: 10px;\n                line-height: 1.2;\n            }\n            \n            /* Adaptations mobiles */\n            @media screen and (max-width: 782px) {\n                #order_data .order_data_column_container {\n                    flex-direction: column;\n                }\n                \n                #order_data .order_data_column {\n                    border-right: none;\n                    border-bottom: 1px solid var(--fs-border-color);\n                    padding: 6px 8px;\n                }\n                \n                #order_data .order_data_column:last-child {\n                    border-bottom: none;\n                }\n                \n                #order_data .order_data_column .form-field-row .form-field {\n                    flex: 1 1 100%;\n                }\n                \n                #order_data .order_data_column h3 {\n                    font-size: 13px;\n                }\n                \n                #order_data .order_data_column .form-field input,\n                #order_data .order_data_column .form-field select {\n                    height: 20px;\n                    font-size: 10px;\n                }\n            }\n        </style>\n        \n        <script>\n        jQuery(document).ready(function($) {\n            // Restructurer le contenu pour aligner état et client sur la même ligne\n            var $etatField = $('#order_data .order_data_column:first-child').find('p').eq(2).prev('label').parent();\n            var $clientField = $('#order_data .order_data_column:first-child').find('p').eq(3).prev('label').parent();\n            \n            // Créer un conteneur pour les deux champs\n            var $rowContainer = $('<div class=\"form-field-row\"></div>');\n            \n            // Convertir les paragraphes en div avec classe form-field\n            $etatField.wrap('<div class=\"form-field\"></div>');\n            $clientField.wrap('<div class=\"form-field\"></div>');\n            \n            // Déplacer les éléments dans le conteneur\n            $etatField = $etatField.parent();\n            $clientField = $clientField.parent();\n            \n            $etatField.add($clientField).wrapAll($rowContainer);\n            \n            // Restructurer le titre principal pour un meilleur design\n            var headerTitle = $('.woocommerce-order-data__heading').text();\n            var commandeNum = headerTitle.match(/n°(\\d+)/);\n            var ipAddress = $('p:contains(\"Adresse IP\")').text();\n            \n            if (commandeNum && commandeNum[1]) {\n                // Créer un nouveau titre avec style amélioré\n                var titleHtml = '<div class=\"commande-title\">' +\n                                '<span class=\"commande-numero\">Détails Commande n°' + commandeNum[1] + '</span>' +\n                                '<span class=\"commande-ip\">' + ipAddress + '</span>' +\n                                '</div>';\n                \n                // Remplacer l'ancien titre\n                $('.woocommerce-order-data__heading').replaceWith(titleHtml);\n                $('p:contains(\"Adresse IP\")').remove();\n            }\n            \n            // Améliorer la présentation de la date de création\n            var $dateCreation = $('#order_data .order_data_column:first-child').find('p').eq(0);\n            var $dateLabel = $dateCreation.prev('label');\n            \n            if ($dateCreation.find('input').length) {\n                $dateCreation.addClass('date-creation');\n                $dateLabel.insertBefore($dateCreation);\n            }\n            \n            // Ne plus modifier le texte Expédition en JS (maintenant fait en CSS)\n        });\n        </script>\n        <?php\n    }\n}\nadd_action('admin_head', 'fs_woocommerce_order_details_styles');\n\n/**\n * Plugin Name: FS - Amélioration Détails Produits WooCommerce\n * Description: Redesign de la section produits dans les commandes WooCommerce\n * Version: 1.6\n * Author: Formation Stratégique\n */\n\n// Empêcher l'accès direct\nif (!defined('ABSPATH')) {\n    exit;\n}\n\n/**\n * Ajoute les styles CSS et JavaScript pour la section des produits de commande\n */\nfunction fs_woocommerce_order_products_styles() {\n    // Ne charger les styles que sur les pages d'édition de commande WooCommerce\n    $screen = get_current_screen();\n    if ($screen && $screen->id === 'shop_order') {\n        ?>\n        <style>\n            /* Variables de couleurs cohérentes avec votre style existant */\n            :root {\n                --fs-primary-color: #4a6fdc;\n                --fs-primary-hover: #3a5ecc;\n                --fs-success-color: #28a745;\n                --fs-warning-color: #ffc107;\n                --fs-danger-color: #dc3545;\n                --fs-info-color: #17a2b8;\n                --fs-light-color: #f8f9fa;\n                --fs-dark-color: #343a40;\n                --fs-border-color: #dee2e6;\n                --fs-text-color: #333;\n                --fs-bg-hover: #f8f9fa;\n                --fs-header-bg: #d5ebff;\n            }\n            \n            /* Table des produits */\n            .woocommerce_order_items_wrapper {\n                margin-bottom: 20px;\n                box-shadow: 0 2px 5px rgba(0,0,0,0.05);\n                border-radius: 5px;\n                overflow: hidden;\n            }\n            \n            /* En-tête de la table - Fond bleu */\n            table.woocommerce_order_items thead th {\n                background-color: var(--fs-header-bg) !important;\n                border-bottom: 1px solid var(--fs-border-color);\n                padding: 8px 10px;\n                font-weight: 600;\n                font-size: 13px;\n                text-align: left;\n                color: var(--fs-dark-color);\n                border-bottom: 2px solid #4a6fdc !important;\n            }\n            \n            /* Conserver la colonne thumb mais la rendre invisible */\n            table.woocommerce_order_items .thumb {\n                width: 1px !important;\n                padding: 0 !important;\n                overflow: hidden;\n                visibility: hidden;\n            }\n            \n            /* Style des lignes */\n            table.woocommerce_order_items td {\n                padding: 3px;\n                vertical-align: middle;\n                border-bottom: 1px solid var(--fs-border-color);\n                font-size: 13px;\n            }\n            \n            table.woocommerce_order_items tr:last-child td {\n                border-bottom: none;\n            }\n            \n            /* Style compact pour les détails produit */\n            table.woocommerce_order_items .item {\n                padding: 3px;\n            }\n            \n            /* Réduire le padding spécifiquement pour les lignes de frais */\n            table.woocommerce_order_items tr.fee td {\n                padding: 3px !important;\n                line-height: 1.2;\n            }\n            \n            /* Titre du produit */\n            table.woocommerce_order_items .name a.wc-order-item-name {\n                font-weight: 600;\n                color: var(--fs-primary-color);\n                text-decoration: none;\n                display: block;\n                margin-bottom: 3px;\n            }\n            \n            table.woocommerce_order_items .name a.wc-order-item-name:hover {\n                text-decoration: underline;\n            }\n            \n            /* SKU et code */\n            table.woocommerce_order_items .name .wc-order-item-sku,\n            table.woocommerce_order_items .name .item-meta {\n                font-size: 12px;\n                color: #666;\n                display: block;\n                margin-bottom: 2px;\n            }\n            \n            /* Organisation des informations de session en grille - 2 colonnes */\n            table.woocommerce_order_items .name .session-details {\n                display: grid;\n                grid-template-columns: 1fr 2fr;\n                grid-gap: 3px 5px;\n                margin-top: 5px;\n                font-size: 12px;\n            }\n            \n            table.woocommerce_order_items .name .session-details > span {\n                display: contents;\n            }\n            \n            table.woocommerce_order_items .name .session-details .column-left,\n            table.woocommerce_order_items .name .session-details .column-right {\n                display: grid;\n                grid-template-columns: 80px 1fr;\n                grid-gap: 2px 3px;\n            }\n            \n            table.woocommerce_order_items .name .session-details .label {\n                font-weight: 600;\n                color: #555;\n            }\n            \n            table.woocommerce_order_items .name .session-details .value {\n                color: #333;\n            }\n            \n            /* Alignement des colonnes numériques */\n            table.woocommerce_order_items .line_cost,\n            table.woocommerce_order_items .quantity,\n            table.woocommerce_order_items .line_tax {\n                text-align: right;\n                white-space: nowrap;\n            }\n            \n            /* Mise en évidence au survol */\n            table.woocommerce_order_items tbody tr:hover {\n                background-color: var(--fs-bg-hover);\n            }\n            \n            /* Style du pied de tableau - Design condensé sur une ligne */\n            table.woocommerce_order_items tfoot {\n                background-color: #f8f9fa;\n                border-top: 2px solid var(--fs-primary-color);\n            }\n            \n            /* Style pour l'affichage condensé des totaux */\n            .wc-order-data-row {\n                position: relative;\n            }\n            \n            /* Masquer le contenu original de la dernière ligne de totaux */\n            .wc-order-data-row:last-child {\n                min-height: 50px;\n            }\n            \n            /* Style pour l'affichage condensé personnalisé */\n            .condensed-totals {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 4px 8px;\n                background: #f8f9fa;\n                border: none;\n                border-radius: 0;\n                margin: 5px 0;\n                box-shadow: none;\n            }\n            \n            .condensed-totals .details {\n                font-size: 13px;\n                color: var(--fs-primary-color);\n                font-weight: 500;\n            }\n            \n            .condensed-totals .total {\n                font-size: 16px;\n                font-weight: bold;\n                color: #28a745;\n            }\n            \n            /* Masquer les totaux originaux pour éviter la duplication */\n            .wc-order-totals-items {\n                display: none !important;\n            }\n            \n            /* Masquer le tableau des totaux dans le footer */\n            .wc-order-totals table,\n            .woocommerce-order-totals table {\n                display: none !important;\n            }\n            \n            /* Masquer les lignes de totaux dans le tfoot du tableau principal */\n            #woocommerce-order-items table.woocommerce_order_items tfoot {\n                display: none !important;\n            }\n            \n            /* Classe pour masquer les lignes de totaux en double */\n            .hide-duplicate-totals {\n                display: none !important;\n            }\n            \n            /* Masquer visuellement les lignes individuelles des totaux mais les garder accessibles */\n            table.woocommerce_order_items tfoot tr {\n                visibility: hidden;\n                height: 0;\n                line-height: 0;\n                padding: 0;\n                border: none;\n            }\n            \n            table.woocommerce_order_items tfoot tr th,\n            table.woocommerce_order_items tfoot tr td {\n                padding: 0;\n                height: 0;\n                line-height: 0;\n                border: none;\n            }\n            \n            /* Afficher uniquement la dernière ligne (total) mais la transformer */\n            table.woocommerce_order_items tfoot tr:last-child {\n                visibility: visible;\n                height: auto;\n                line-height: normal;\n                background-color: #f8f9fa;\n            }\n            \n            table.woocommerce_order_items tfoot tr:last-child th {\n                text-align: left;\n                padding: 12px 15px;\n                font-weight: 600;\n                font-size: 13px;\n                border: none;\n                position: relative;\n                white-space: nowrap;\n                overflow: hidden;\n                text-overflow: ellipsis;\n            }\n            \n            table.woocommerce_order_items tfoot tr:last-child td {\n                text-align: right;\n                padding: 12px 15px;\n                font-weight: 700;\n                font-size: 14px;\n                border: none;\n                position: relative;\n                white-space: nowrap;\n            }\n            \n            /* Style des boutons */            \n            \n            .wc-order-data-row .button.calculate-action {\n                background-color: var(--fs-success-color);\n                border-color: var(--fs-success-color);\n                color: white;\n            }\n            \n            .wc-order-data-row .button.calculate-action:hover {\n                background-color: #218838;\n                border-color: #1e7e34;\n            }\n            \n            /* Réduire l'espacement vertical */\n            #woocommerce-order-items .inside {\n                padding: 0;\n                margin: 0;\n            }\n            \n            #woocommerce-order-items .wc-order-data-row {\n                padding: 3px;\n                line-height: 1.8em;\n            }\n            \n            /* Factbox footer */\n            .wc-order-data-row {\n                display: flex;\n                justify-content: space-between;\n                padding: 6px;\n                border-top: 1px solid var(--fs-success-color);\n            }\n            \n            /* Compact view pour les infos */\n            .compact-info {\n                display: flex;\n                flex-wrap: wrap;\n                gap: 10px;\n                font-size: 12px;\n            }\n            \n            .compact-info .info-group {\n                display: flex;\n                align-items: center;\n            }\n            \n            .compact-info .info-label {\n                font-weight: 600;\n                margin-right: 5px;\n                color: #555;\n            }\n            \n            .compact-info .info-value {\n                color: #333;\n            }\n            \n            /* Correctif pour pied de page de commande (alignement) */\n            .woocommerce-order-payment .label,\n            .woocommerce-order-payment dt {\n                text-align: right !important;\n                padding-right: 5px !important;\n            }\n            \n            .woocommerce-order-payment dd,\n            .woocommerce-order-payment .total {\n                text-align: right !important;\n            }\n            \n            /* Traduction de \"Paid\" en \"Payé\" */\n            .wc-order-totals tr:last-child th:contains(\"Paid\") {\n                text-align: right;\n            }\n\n            /* Masquer les métadonnées originales */\n            .wc-order-item-meta {\n                display: none !important;\n            }\n        </style>\n        \n        <script>\n        jQuery(document).ready(function($) {\n            // Variables pour éviter les rechargements en boucle\n            var isEnhancingOrderItems = false;\n            var itemsEnhanced = {};\n            var ajaxRequests = {};\n            \n            // Fonction pour obtenir l'ID de commande actuelle\n            function getCurrentOrderId() {\n                return $('.post-type-shop_order #post_ID').val() || \n                       $('.post-type-shop_order input[name=\"post_ID\"]').val() || \n                       window.location.pathname.match(/post=(\\d+)/)?.[1];\n            }\n            \n            // Variable pour éviter les créations multiples\n            var condensedTotalsCreated = false;\n            \n            // Fonction pour créer l'affichage condensé des totaux\n            function createCondensedTotals() {\n                // Éviter les créations multiples\n                if (condensedTotalsCreated || $('.condensed-totals').length > 0) {\n                    return;\n                }\n                \n                condensedTotalsCreated = true;\n                \n                setTimeout(function() {\n                    // Masquer les lignes de totaux en double\n                    $('.wc-order-data-row').each(function() {\n                        var $row = $(this);\n                        var text = $row.text().toLowerCase();\n                        \n                        // Masquer les lignes contenant des totaux mais pas les boutons\n                        if ((text.includes('sous-total') || text.includes('frais') || text.includes('tva') || text.includes('total de la commande')) && !$row.find('button, .button').length) {\n                            $row.addClass('hide-duplicate-totals');\n                        }\n                    });\n                    \n                    var totalsData = {\n                        subtotal: '',\n                        fees: '',\n                        tax: '',\n                        total: ''\n                    };\n                    \n                    // Récupérer les données depuis le texte visible de la page\n                    var pageText = $('#woocommerce-order-items').text();\n                    \n                    // Extraire le sous-total\n                    var subtotalMatch = pageText.match(/Sous-total des articles[\\s\\S]*?([0-9,]+[.,][0-9]{2})/i);\n                    if (subtotalMatch) totalsData.subtotal = subtotalMatch[1] + '€';\n                    \n                    // Extraire les frais\n                    var feesMatch = pageText.match(/Frais[\\s\\S]*?([0-9,]+[.,][0-9]{2})/i);\n                    if (feesMatch) totalsData.fees = feesMatch[1] + '€';\n                    \n                    // Extraire la TVA\n                    var taxMatch = pageText.match(/TVA[\\s\\S]*?([0-9,]+[.,][0-9]{2})/i);\n                    if (taxMatch) totalsData.tax = taxMatch[1] + '€';\n                    \n                    // Extraire le total\n                    var totalMatch = pageText.match(/Total de la commande[\\s\\S]*?([0-9,]+[.,][0-9]{2})/i);\n                    if (totalMatch) totalsData.total = totalMatch[1] + '€';\n                    \n                    // Si on n'a pas trouvé le total, essayer une autre approche\n                    if (!totalsData.total) {\n                        var allAmounts = pageText.match(/([0-9,]+[.,][0-9]{2})/g);\n                        if (allAmounts && allAmounts.length > 0) {\n                            totalsData.total = allAmounts[allAmounts.length - 1] + '€';\n                        }\n                    }\n                    \n                    // Créer le contenu condensé avec couleurs\n                    var condensedContent = '';\n                    if (totalsData.subtotal) condensedContent += '<span style=\"color: var(--fs-primary-color);\">Sous-total: ' + totalsData.subtotal + '</span>';\n                    if (totalsData.fees) {\n                        if (condensedContent) condensedContent += ' | ';\n                        condensedContent += '<span style=\"color: var(--fs-primary-color);\">Frais: ' + totalsData.fees + '</span>';\n                    }\n                    if (totalsData.tax) {\n                        if (condensedContent) condensedContent += ' | ';\n                        condensedContent += '<span style=\"color: var(--fs-primary-color);\">TVA: ' + totalsData.tax + '</span>';\n                    }\n                    \n                    // Créer et insérer l'affichage condensé\n                    if (totalsData.total) {\n                        var $condensedDiv = $('<div class=\"condensed-totals\">');\n                        $condensedDiv.html(\n                            '<div class=\"details\">' + (condensedContent || 'Détails de la commande') + '</div>' +\n                            '<div class=\"total\">Total: ' + totalsData.total + '</div>'\n                        );\n                        \n                        // Insérer après le tableau des items\n                        $('#woocommerce-order-items table.woocommerce_order_items').after($condensedDiv);\n                    }\n                }, 200);\n            }\n            \n            // Fonction pour récupérer les métadonnées d'item depuis le serveur\n            function getOrderItemMetadataFromServer(itemId, orderId, callback) {\n                // Annuler la requête précédente si elle existe\n                if (ajaxRequests[itemId]) {\n                    ajaxRequests[itemId].abort();\n                }\n                \n                // Créer une nouvelle requête\n                ajaxRequests[itemId] = $.ajax({\n                    url: ajaxurl,\n                    type: 'POST',\n                    data: {\n                        action: 'fs_get_order_item_details',\n                        item_id: itemId,\n                        order_id: orderId,\n                        security: '<?php echo wp_create_nonce('fs-order-item-details'); ?>'\n                    },\n                    dataType: 'json',\n                    success: function(response) {\n                        delete ajaxRequests[itemId];\n                        callback(response);\n                    },\n                    error: function(xhr, status, error) {\n                        delete ajaxRequests[itemId];\n                        if (status !== 'abort') {\n                            callback({success: false, error: error});\n                        }\n                    }\n                });\n                \n                return ajaxRequests[itemId];\n            }\n            \n            // Améliorer l'affichage des produits dans la commande\n            function enhanceOrderItems() {\n                // Éviter les appels récursifs\n                if (isEnhancingOrderItems) {\n                    return;\n                }\n                \n                isEnhancingOrderItems = true;\n                \n                var orderId = getCurrentOrderId();\n                if (!orderId) {\n                    console.error('Impossible de déterminer l\\'ID de commande');\n                    isEnhancingOrderItems = false;\n                    return;\n                }\n                \n                // Masquer les métadonnées originales\n                $('#woocommerce-order-items .wc-order-item-meta, #woocommerce-order-items .display_meta').hide();\n                \n                // Styliser le bouton Recalculer\n                $('.wc-order-data-row .button[name=\"calc_totals\"]').addClass('calculate-action');\n                \n                // Ajuster les couleurs de l'en-tête\n                $('#woocommerce-order-items table.woocommerce_order_items thead th').css({\n                    'background-color': '#d5ebff',\n                    'border-bottom': '2px solid #4a6fdc',\n                    'font-weight': '600',\n                    'color': '#333'\n                });\n                \n                // Réduire le padding des totaux\n                $('#woocommerce-order-items table.woocommerce_order_items tfoot th, #woocommerce-order-items table.woocommerce_order_items tfoot td').css({\n                    'padding': '5px 10px'\n                });\n                \n                // Traduire \"Paid\" en \"Payé\"\n                $('.wc-order-totals tr:last-child th:contains(\"Paid\")').text('Payé:');\n                \n                // Créer l'affichage condensé des totaux\n                createCondensedTotals();\n                \n                // Parcourir chaque ligne de produit\n                $('#woocommerce-order-items table.woocommerce_order_items tbody tr.item').each(function() {\n                    var $row = $(this);\n                    var itemId = $row.attr('data-order_item_id');\n                    \n                    if (!itemId || itemsEnhanced[itemId]) {\n                        return; // Item déjà traité ou sans ID\n                    }\n                    \n                    // Marquer cet item comme traité\n                    itemsEnhanced[itemId] = true;\n                    \n                    // Cacher la cellule d'image\n                    $row.find('td.thumb').empty().css({\n                        'width': '1px',\n                        'padding': '0',\n                        'visibility': 'hidden'\n                    });\n                    \n                    // Supprimer les anciens conteneurs de détails s'ils existent\n                    var $nameCell = $row.find('td.name');\n                    $nameCell.find('.session-details').remove();\n                    \n                    // Ajouter un conteneur pour les détails de session\n                    var sessionDetailsId = 'session-details-' + itemId;\n                    $nameCell.append('<div id=\"' + sessionDetailsId + '\" class=\"session-details\"><div style=\"grid-column: span 2;\">Chargement des détails...</div></div>');\n                    \n                    // Récupérer les métadonnées via AJAX\n                    getOrderItemMetadataFromServer(itemId, orderId, function(response) {\n                        if (response.success && response.data) {\n                            var metadata = response.data;\n                            var detailsHtml = '';\n                            \n                            // Organisation en 2 colonnes\n                            var leftColumn = '';\n                            var rightColumn = '';\n                            \n                            // Colonne gauche\n                            if (metadata['Niveau']) {\n                                leftColumn += '<span class=\"label\">Niveau:</span>';\n                                leftColumn += '<span class=\"value\">' + metadata['Niveau'] + '</span>';\n                            }\n                            \n                            if (metadata['Début']) {\n                                leftColumn += '<span class=\"label\">Début:</span>';\n                                leftColumn += '<span class=\"value\">' + metadata['Début'] + '</span>';\n                            }\n                            \n                            if (metadata['Session n°']) {\n                                leftColumn += '<span class=\"label\">Session n°:</span>';\n                                leftColumn += '<span class=\"value\">' + metadata['Session n°'] + '</span>';\n                            }\n                            \n                            // Colonne droite\n                            if (metadata['Fin']) {\n                                rightColumn += '<span class=\"label\">Fin:</span>';\n                                rightColumn += '<span class=\"value\">' + metadata['Fin'] + '</span>';\n                            }\n                            \n                            if (metadata['Adresse']) {\n                                rightColumn += '<span class=\"label\">Adresse:</span>';\n                                rightColumn += '<span class=\"value\">' + metadata['Adresse'] + '</span>';\n                            }\n                            \n                            // Combiner les colonnes\n                             detailsHtml = '<div class=\"column-left\">' + leftColumn + '</div><div class=\"column-right\">' + rightColumn + '</div>';\n                             \n                             if (detailsHtml === '<div class=\"column-left\"></div><div class=\"column-right\"></div>') {\n                                detailsHtml = '<div style=\"grid-column: span 2;\">Aucun détail supplémentaire disponible.</div>';\n                            }\n                            \n                            $('#' + sessionDetailsId).html(detailsHtml);\n                        } else {\n                            $('#' + sessionDetailsId).html('<div style=\"grid-column: span 2;\">Impossible de récupérer les détails.</div>');\n                        }\n                    });\n                });\n                \n                isEnhancingOrderItems = false;\n            }\n            \n            // Exécuter l'amélioration initiale\n            setTimeout(function() {\n                enhanceOrderItems();\n            }, 300);\n            \n            // Réexécuter après certaines actions AJAX, mais pas toutes\n            var ajaxCompleteTimeout;\n            $(document).ajaxComplete(function(event, xhr, settings) {\n                // Vérifier que c'est un AJAX spécifique qui modifie la commande\n                if (settings.url && settings.url.indexOf('admin-ajax.php') > -1 && \n                   (settings.data && (\n                    settings.data.indexOf('woocommerce_calc_line_taxes') > -1 ||\n                    settings.data.indexOf('woocommerce_save_order_items') > -1 ||\n                    settings.data.indexOf('woocommerce_add_order_item') > -1 ||\n                    settings.data.indexOf('woocommerce_remove_order_item') > -1\n                   ))) {\n                    \n                    // Annuler le timeout précédent s'il existe\n                    clearTimeout(ajaxCompleteTimeout);\n                    \n                    // Réinitialiser les variables de contrôle\n                    itemsEnhanced = {};\n                    condensedTotalsCreated = false;\n                    \n                    // Supprimer l'ancien affichage condensé\n                    $('.condensed-totals').remove();\n                    \n                    // Réappliquer après un délai\n                    ajaxCompleteTimeout = setTimeout(function() {\n                        enhanceOrderItems();\n                    }, 300);\n                }\n            });\n        });\n        </script>\n        <?php\n    }\n}\nadd_action('admin_head', 'fs_woocommerce_order_products_styles');\n\n/**\n * Fonction AJAX pour récupérer les détails d'un item de commande\n */\nfunction fs_get_order_item_details() {\n    check_ajax_referer('fs-order-item-details', 'security');\n    \n    if (!current_user_can('edit_shop_orders')) {\n        wp_send_json_error('Permissions insuffisantes');\n        return;\n    }\n    \n    $item_id = isset($_POST['item_id']) ? intval($_POST['item_id']) : 0;\n    $order_id = isset($_POST['order_id']) ? intval($_POST['order_id']) : 0;\n    \n    if (!$item_id || !$order_id) {\n        wp_send_json_error('Paramètres manquants');\n        return;\n    }\n    \n    // Récupérer la commande\n    $order = wc_get_order($order_id);\n    if (!$order) {\n        wp_send_json_error('Commande introuvable');\n        return;\n    }\n    \n    // Récupérer l'item spécifique\n    $item = $order->get_item($item_id);\n    if (!$item) {\n        wp_send_json_error('Item de commande introuvable');\n        return;\n    }\n    \n    // Récupérer toutes les métadonnées liées à cet item\n    $metadata = $item->get_meta_data();\n    $formatted_metadata = array();\n    \n    // Parcourir toutes les métadonnées et récupérer celles qui nous intéressent\n    foreach ($metadata as $meta) {\n        $data = $meta->get_data();\n        $key = $data['key'];\n        $value = $data['value'];\n        \n        // Correspondance directe des clés\n        if ($key === 'fsbdd_niveau') {\n            $formatted_metadata['Niveau'] = $value;\n        } elseif ($key === 'we_startdate') {\n            $formatted_metadata['Début'] = $value;\n        } elseif ($key === 'we_enddate') {\n            $formatted_metadata['Fin'] = $value;\n        } elseif ($key === 'fsbdd_actionum') {\n            $formatted_metadata['Session n°'] = $value;\n        } elseif ($key === 'fsbdd_select_lieuforminter') {\n            $formatted_metadata['Adresse'] = $value;\n        }\n    }\n    \n    // Si nous n'avons pas trouvé certaines métadonnées, essayer de les récupérer depuis le CPT\n    if (!isset($formatted_metadata['Niveau']) || !isset($formatted_metadata['Début']) || \n        !isset($formatted_metadata['Fin']) || !isset($formatted_metadata['Session n°']) || \n        !isset($formatted_metadata['Adresse'])) {\n        \n        // Récupérer l'ID de l'action de formation associée\n        $action_id = $item->get_meta('fsbdd_relsessaction_cpt_produit');\n        \n        if ($action_id) {\n            // Récupérer les informations depuis le CPT\n            if (!isset($formatted_metadata['Niveau'])) {\n                $niveau = get_post_meta($action_id, 'fsbdd_select_niveausession', true);\n                if ($niveau) {\n                    $formatted_metadata['Niveau'] = $niveau;\n                }\n            }\n            \n            if (!isset($formatted_metadata['Début'])) {\n                $startdate = get_post_meta($action_id, 'we_startdate', true);\n                if ($startdate) {\n                    $formatted_metadata['Début'] = date_i18n('j F Y', $startdate);\n                }\n            }\n            \n            if (!isset($formatted_metadata['Fin'])) {\n                $enddate = get_post_meta($action_id, 'we_enddate', true);\n                if ($enddate) {\n                    $formatted_metadata['Fin'] = date_i18n('j F Y', $enddate);\n                }\n            }\n            \n            if (!isset($formatted_metadata['Session n°'])) {\n                $numero = get_the_title($action_id);\n                if ($numero) {\n                    $formatted_metadata['Session n°'] = $numero;\n                }\n            }\n            \n            if (!isset($formatted_metadata['Adresse'])) {\n                $lieu = get_post_meta($action_id, 'fsbdd_select_lieusession', true);\n                if ($lieu) {\n                    $formatted_metadata['Adresse'] = $lieu;\n                }\n            }\n        }\n    }\n    \n    // Renvoyer les métadonnées\n    wp_send_json_success($formatted_metadata);\n}\nadd_action('wp_ajax_fs_get_order_item_details', 'fs_get_order_item_details');",
  "tags": "",
  "scope": "admin",
  "priority": "10",
  "active": true,
  "modified": "2025-07-09 22:32:04",
  "revision": "115",
  "cloud_id": null
}